var globalThis=this,global=this;function __skpm_run(e,t){globalThis.context=t;try{var r=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=8)}([function(e,t){function r(){}function n(e){if(!(this instanceof n))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],l(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,n._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(o){return void a(t.promise,o)}i(t.promise,n)}else(1===e._state?i:a)(t.promise,e._value)}))):e._deferreds.push(t)}function i(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof n)return e._state=3,e._value=t,void c(e);if("function"==typeof r)return void l(r.bind(t),e)}e._state=1,e._value=t,c(e)}catch(o){a(e,o)}}function a(e,t){e._state=2,e._value=t,c(e)}function c(e){2===e._state&&0===e._deferreds.length&&n._immediateFn((function(){e._handled||n._unhandledRejectionFn(e._value,e)}));for(var t=0,r=e._deferreds.length;t<r;t++)o(e,e._deferreds[t]);e._deferreds=null}function s(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}function l(e,t){var r=!1;try{e((function(e){r?n._multipleResolvesFn("resolve",t,e):(r=!0,i(t,e))}),(function(e){r?n._multipleResolvesFn("reject",t,e):(r=!0,a(t,e))}))}catch(o){if(r)return void n._multipleResolvesFn("reject",t,o);r=!0,a(t,o)}}n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){var n=new this.constructor(r);return o(this,new s(e,t,n)),n},n.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},n.all=function(e){return new n((function(t,r){if(!Array.isArray(e))return r(new TypeError("Promise.all accepts an array"));var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var o=n.length;function i(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void c.call(a,(function(t){i(e,t)}),r)}n[e]=a,0==--o&&t(n)}catch(s){r(s)}}for(var a=0;a<n.length;a++)i(a,n[a])}))},n.resolve=function(e){return e&&"object"==typeof e&&e.constructor===n?e:new n((function(t){t(e)}))},n.reject=function(e){return new n((function(t,r){r(e)}))},n.race=function(e){return new n((function(t,r){if(!Array.isArray(e))return r(new TypeError("Promise.race accepts an array"));for(var o=0,i=e.length;o<i;o++)n.resolve(e[o]).then(t,r)}))},n._immediateFn=setImmediate,n._unhandledRejectionFn=function(e,t){"undefined"!=typeof process&&process.listenerCount&&(process.listenerCount("unhandledRejection")||process.listenerCount("uncaughtException"))?(process.emit("unhandledRejection",e,t),process.emit("uncaughtException",e,"unhandledRejection")):"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)},n._multipleResolvesFn=function(e,t,r){"undefined"!=typeof process&&process.emit&&process.emit("multipleResolves",e,t,r)},e.exports=n},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("sketch")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("path")},function(e,t,r){var n=r(6).Buffer,o=r(9),i=o.parseStat,a=o.fsError,c=o.fsErrorForPath,s=o.encodingFromOptions,l=o.NOT_IMPLEMENTED;e.exports.constants={F_OK:0,R_OK:4,W_OK:2,X_OK:1},e.exports.access=l("access"),e.exports.accessSync=function(t,r){r|=0;var n=NSFileManager.defaultManager();switch(r){case 0:canAccess=e.exports.existsSync(t);break;case 1:canAccess=Boolean(Number(n.isExecutableFileAtPath(t)));break;case 2:canAccess=Boolean(Number(n.isWritableFileAtPath(t)));break;case 3:canAccess=Boolean(Number(n.isExecutableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)));break;case 4:canAccess=Boolean(Number(n.isReadableFileAtPath(t)));break;case 5:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isExecutableFileAtPath(t)));break;case 6:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)));break;case 7:canAccess=Boolean(Number(n.isReadableFileAtPath(t)))&&Boolean(Number(n.isWritableFileAtPath(t)))&&Boolean(Number(n.isExecutableFileAtPath(t)))}if(!canAccess)throw new Error("Can't access "+String(t))},e.exports.appendFile=l("appendFile"),e.exports.appendFileSync=function(t,r,o){if(!e.exports.existsSync(t))return e.exports.writeFileSync(t,r,o);var i=NSFileHandle.fileHandleForWritingAtPath(t);i.seekToEndOfFile();var a=s(o,"utf8"),c=n.from(r,"NSData"===a||"buffer"===a?void 0:a).toNSData();i.writeData(c)},e.exports.chmod=l("chmod"),e.exports.chmodSync=function(e,t){var r=MOPointer.alloc().init();if(NSFileManager.defaultManager().setAttributes_ofItemAtPath_error({NSFilePosixPermissions:t},e,r),null!==r.value())throw c(e,void 0,r.value())},e.exports.chown=l("chown"),e.exports.chownSync=l("chownSync"),e.exports.close=l("close"),e.exports.closeSync=l("closeSync"),e.exports.copyFile=l("copyFile"),e.exports.copyFileSync=function(e,t,r){var n=MOPointer.alloc().init();if(NSFileManager.defaultManager().copyItemAtPath_toPath_error(e,t,n),null!==n.value())throw c(e,!1,n.value())},e.exports.createReadStream=l("createReadStream"),e.exports.createWriteStream=l("createWriteStream"),e.exports.exists=l("exists"),e.exports.existsSync=function(e){var t=NSFileManager.defaultManager();return Boolean(Number(t.fileExistsAtPath(e)))},e.exports.fchmod=l("fchmod"),e.exports.fchmodSync=l("fchmodSync"),e.exports.fchown=l("fchown"),e.exports.fchownSync=l("fchownSync"),e.exports.fdatasync=l("fdatasync"),e.exports.fdatasyncSync=l("fdatasyncSync"),e.exports.fstat=l("fstat"),e.exports.fstatSync=l("fstatSync"),e.exports.fsync=l("fsync"),e.exports.fsyncSync=l("fsyncSync"),e.exports.ftruncate=l("ftruncate"),e.exports.ftruncateSync=l("ftruncateSync"),e.exports.futimes=l("futimes"),e.exports.futimesSync=l("futimesSync"),e.exports.lchmod=l("lchmod"),e.exports.lchmodSync=l("lchmodSync"),e.exports.lchown=l("lchown"),e.exports.lchownSync=l("lchownSync"),e.exports.link=l("link"),e.exports.linkSync=function(e,t){var r=MOPointer.alloc().init();if(NSFileManager.defaultManager().linkItemAtPath_toPath_error(e,t,r),null!==r.value())throw c(e,void 0,r.value())},e.exports.lstat=l("lstat"),e.exports.lstatSync=function(e){var t=MOPointer.alloc().init(),r=NSFileManager.defaultManager().attributesOfItemAtPath_error(e,t);if(null!==t.value())throw c(e,void 0,t.value());return i(r)},e.exports.mkdir=l("mkdir"),e.exports.mkdirSync=function(e,t){var r=511,n=!1;t&&t.mode&&(r=t.mode),t&&t.recursive&&(n=t.recursive),"number"==typeof t&&(r=t);var o=MOPointer.alloc().init();if(NSFileManager.defaultManager().createDirectoryAtPath_withIntermediateDirectories_attributes_error(e,n,{NSFilePosixPermissions:r},o),null!==o.value())throw new Error(o.value())},e.exports.mkdtemp=l("mkdtemp"),e.exports.mkdtempSync=function(t){var r=t+function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;r<6;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}();return e.exports.mkdirSync(r),r},e.exports.open=l("open"),e.exports.openSync=l("openSync"),e.exports.read=l("read"),e.exports.readdir=l("readdir"),e.exports.readdirSync=function(e,t){for(var r=s(t,"utf8"),o=NSFileManager.defaultManager().subpathsAtPath(e),i=[],a=0;a<o.length;a++){var c=o[a];i.push("buffer"===r?n.from(c):String(c))}return i},e.exports.readFile=l("readFile"),e.exports.readFileSync=function(e,t){var r=s(t,"buffer"),o=NSFileManager.defaultManager().contentsAtPath(e);if(!o)throw c(e,!1);var i=n.from(o);return"buffer"===r?i:"NSData"===r?i.toNSData():i.toString(r)},e.exports.readlink=l("readlink"),e.exports.readlinkSync=function(e){var t=MOPointer.alloc().init(),r=NSFileManager.defaultManager().destinationOfSymbolicLinkAtPath_error(e,t);if(null!==t.value())throw c(e,void 0,t.value());return String(r)},e.exports.readSync=l("readSync"),e.exports.realpath=l("realpath"),e.exports.realpath.native=l("realpath.native"),e.exports.realpathSync=function(e){return String(NSString.stringWithString(e).stringByResolvingSymlinksInPath())},e.exports.realpathSync.native=l("realpathSync.native"),e.exports.rename=l("rename"),e.exports.renameSync=function(e,t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();n.moveItemAtPath_toPath_error(e,t,r);var o=r.value();if(null!==o){if("NSCocoaErrorDomain"!==String(o.domain())||516!==Number(o.code()))throw c(e,void 0,o);var i=MOPointer.alloc().init();if(n.replaceItemAtURL_withItemAtURL_backupItemName_options_resultingItemURL_error(NSURL.fileURLWithPath(t),NSURL.fileURLWithPath(e),null,NSFileManagerItemReplacementUsingNewMetadataOnly,null,i),null!==i.value())throw c(e,void 0,i.value())}},e.exports.rmdir=l("rmdir"),e.exports.rmdirSync=function(t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();if(!e.exports.lstatSync(t).isDirectory())throw a("ENOTDIR",{path:t,syscall:"rmdir"});if(n.removeItemAtPath_error(t,r),null!==r.value())throw c(t,!0,r.value(),"rmdir")},e.exports.stat=l("stat"),e.exports.statSync=function(t){return e.exports.lstatSync(e.exports.realpathSync(t))},e.exports.symlink=l("symlink"),e.exports.symlinkSync=function(e,t){var r=MOPointer.alloc().init();NSFileManager.defaultManager().createSymbolicLinkAtPath_withDestinationPath_error(t,e,r);if(null!==r.value())throw new Error(r.value())},e.exports.truncate=l("truncate"),e.exports.truncateSync=function(e,t){var r=NSFileHandle.fileHandleForUpdatingAtPath(sFilePath);r.truncateFileAtOffset(t||0),r.closeFile()},e.exports.unlink=l("unlink"),e.exports.unlinkSync=function(t){var r=MOPointer.alloc().init(),n=NSFileManager.defaultManager();if(e.exports.lstatSync(t).isDirectory())throw a("EPERM",{path:t,syscall:"unlink"});n.removeItemAtPath_error(t,r);if(null!==r.value())throw c(t,!1,r.value())},e.exports.unwatchFile=l("unwatchFile"),e.exports.utimes=l("utimes"),e.exports.utimesSync=function(e,t,r){var n=MOPointer.alloc().init();NSFileManager.defaultManager().setAttributes_ofItemAtPath_error({NSFileModificationDate:t},e,n);if(null!==n.value())throw c(e,void 0,n.value())},e.exports.watch=l("watch"),e.exports.watchFile=l("watchFile"),e.exports.write=l("write"),e.exports.writeFile=l("writeFile"),e.exports.writeFileSync=function(e,t,r){var o=s(r,"utf8");n.from(t,"NSData"===o||"buffer"===o?void 0:o).toNSData().writeToFile_atomically(e,!0)},e.exports.writeSync=l("writeSync")},function(e,t){e.exports=require("buffer")},function(e,t,r){(function(t){var n;try{n=r(6).Buffer}catch(o){}e.exports=function(e,r){if("object"!=typeof e||e.isKindOfClass&&e.isKindOfClass(NSString)||(e=(r=e).url),r=r||{},!e)return t.reject("Missing URL");var i;try{i=coscript.createFiber()}catch(o){coscript.shouldKeepAround=!0}return new t((function(o,a){var c=NSURL.alloc().initWithString(e),s=NSMutableURLRequest.requestWithURL(c);if(s.setHTTPMethod(r.method||"GET"),Object.keys(r.headers||{}).forEach((function(e){s.setValue_forHTTPHeaderField(r.headers[e],e)})),r.body){var l;if("string"==typeof r.body)l=NSString.alloc().initWithString(r.body).dataUsingEncoding(NSUTF8StringEncoding);else if(n&&n.isBuffer(r.body))l=r.body.toNSData();else if(r.body.isKindOfClass&&1==r.body.isKindOfClass(NSData))l=r.body;else if(r.body._isFormData){var u=r.body._boundary;(l=r.body._data).appendData(NSString.alloc().initWithString("--"+u+"--\r\n").dataUsingEncoding(NSUTF8StringEncoding)),s.setValue_forHTTPHeaderField("multipart/form-data; boundary="+u,"Content-Type")}else{l=NSJSONSerialization.dataWithJSONObject_options_error(r.body,NSJSONWritingPrettyPrinted,void 0),s.setValue_forHTTPHeaderField(""+l.length(),"Content-Length")}s.setHTTPBody(l)}if(r.cache)switch(r.cache){case"reload":case"no-cache":case"no-store":s.setCachePolicy(1);case"force-cache":s.setCachePolicy(2);case"only-if-cached":s.setCachePolicy(3)}r.credentials||s.setHTTPShouldHandleCookies(!1);var f=!1,p=NSURLSession.sharedSession().dataTaskWithRequest_completionHandler(s,__mocha__.createBlock_function('v32@?0@"NSData"8@"NSURLResponse"16@"NSError"24',(function(e,r,c){return i?i.cleanup():coscript.shouldKeepAround=!1,c?(f=!0,a(c)):o(function e(r,o){for(var i,a=[],c=[],s={},l=0;l<r.allHeaderFields().allKeys().length;l++){var u=r.allHeaderFields().allKeys()[l].toLowerCase(),f=String(r.allHeaderFields()[u]);a.push(u),c.push([u,f]),i=s[u],s[u]=i?i+","+f:f}return{ok:1==(r.statusCode()/200|0),status:Number(r.statusCode()),statusText:String(NSHTTPURLResponse.localizedStringForStatusCode(r.statusCode())),useFinalURL:!0,url:String(r.URL().absoluteString()),clone:e.bind(this,r,o),text:function(){return new t((function(e,t){const r=String(NSString.alloc().initWithData_encoding(o,NSASCIIStringEncoding));r?e(r):t(new Error("Couldn't parse body"))}))},json:function(){return new t((function(e,t){var r=String(NSString.alloc().initWithData_encoding(o,NSUTF8StringEncoding));r?e(JSON.parse(r)):t(new Error("Could not parse JSON because it is not valid UTF-8 data."))}))},blob:function(){return t.resolve(o)},arrayBuffer:function(){return t.resolve(n.from(o))},headers:{keys:function(){return a},entries:function(){return c},get:function(e){return s[e.toLowerCase()]},has:function(e){return e.toLowerCase()in s}}}}(r,e))})));p.resume(),i&&i.onCleanup((function(){f||p.cancel()}))}))}}).call(this,r(0))},function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"onStartup",(function(){return m})),r.d(t,"onShutdown",(function(){return S})),r.d(t,"onSupplyRandomPhoto",(function(){return y})),r.d(t,"onSearchPhoto",(function(){return b})),r.d(t,"default",(function(){return x}));var n=r(3),o=r(4),i=r(1),a=r(5),c=r(2),s=r(10).getImagesURLsForItems,l=c.DataSupplier,u=c.UI,f=c.Settings,p=r(11),h=(p.insertImage,p.getImageFromURL),d=o.join(n.tmpdir(),"com.sketchapp.unsplash-plugin");function m(){l.registerDataSupplier("public.image","Random Photo","SupplyRandomPhoto"),l.registerDataSupplier("public.image","Search Photoâ€¦","SearchPhoto")}function S(){l.deregisterDataSuppliers();try{a.existsSync(d)&&a.rmdirSync(d)}catch(e){console.error(e)}}function y(e){F(e)}function g(e){return"id:"===e.substr(0,3)||-1!==e.indexOf("unsplash.com/photos/")}function v(e){if("id:"===e.substr(0,3))return e.substr(3);var t=e.substr(e.indexOf("unsplash.com/photos/")+20),r=t.search(/[^a-z0-9_-]/i);return-1!==r?t.substr(0,r):t}function b(e){var t=c.getSelectedDocument().selectedLayers.layers,r=t.map((function(e){return f.layerSettingForKey(e,"unsplash.search.term")})).find((function(e){return void 0!==e}))||"People";if(c.version.sketch<53){var n=u.getStringFromUser("Search Unsplash forâ€¦",r).trim();"null"!==n&&(t.forEach((function(e){f.setLayerSettingForKey(e,"unsplash.search.term",n)})),function(e){throw new Error('"'+e+'" is read-only')}("searchTerm"),g(n=encodeURI(n))?F(e,null,v(n)):F(e,n.replace(/\s+/g,"-").toLowerCase()))}else u.getInputFromUser("Search Unsplash forâ€¦",{initialValue:r},(function(r,n){r||"null"!==(n=n.trim())&&(t.forEach((function(e){f.setLayerSettingForKey(e,"unsplash.search.term",n)})),g(n=encodeURI(n))?F(e,null,v(n)):F(e,n.replace(/\s+/g,"-").toLowerCase()))}))}function x(){var e=c.getSelectedDocument(),t=e?e.selectedLayers:[];t.length>0?t.forEach((function(e){var t=f.layerSettingForKey(e,"unsplash.photo.id")||"SymbolInstance"===e.type&&e.overrides.map((function(e){return f.layerSettingForKey(e,"unsplash.photo.id")})).find((function(e){return!!e}));t?NSWorkspace.sharedWorkspace().openURL(NSURL.URLWithString("https://unsplash.com/photos/".concat(t))):u.message("To get a random photo, click Data â€º Unsplash â€º Random Photo in the toolbar, or right click the layer â€º Data Feeds â€º Unsplash â€º Random Photo")})):u.message("Please select at least one layer")}function F(t,r,n){var o=t.data.key,a=i.toArray(t.data.items).map(c.fromNative);u.message("ðŸ•‘ Downloadingâ€¦"),s(a,{searchTerm:r,photoId:n}).then((function(t){return e.all(t.map((function(e){var t=e.data,r=e.item,n=e.index,i=e.frame,a=e.error;a?(u.message(a),console.error(a)):function(e,t,r,n,o){var i="".concat(e.urls.full,"&fit=min&w=").concat(2*o.width,"&h=").concat(2*o.height);h(i).then((function(o){o&&(l.supplyDataAtIndex(t,o,r),"DataOverride"!==n.type&&f.setLayerSettingForKey(n,"unsplash.photo.id",e.id),u.message("ðŸ“· by "+e.user.name+" on Unsplash"))}))}(t,o,n,r,i)})))})).catch((function(e){u.message(e),console.error(e)}))}}.call(this,r(0))},function(e,t){e.exports.parseStat=function(e){return{dev:String(e.NSFileDeviceIdentifier),mode:e.NSFileType|e.NSFilePosixPermissions,nlink:Number(e.NSFileReferenceCount),uid:String(e.NSFileOwnerAccountID),gid:String(e.NSFileGroupOwnerAccountID),size:Number(e.NSFileSize),atimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),mtimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),ctimeMs:1e3*Number(e.NSFileModificationDate.timeIntervalSince1970()),birthtimeMs:1e3*Number(e.NSFileCreationDate.timeIntervalSince1970()),atime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),mtime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),ctime:new Date(1e3*Number(e.NSFileModificationDate.timeIntervalSince1970())+.5),birthtime:new Date(1e3*Number(e.NSFileCreationDate.timeIntervalSince1970())+.5),isBlockDevice:function(){return e.NSFileType===NSFileTypeBlockSpecial},isCharacterDevice:function(){return e.NSFileType===NSFileTypeCharacterSpecial},isDirectory:function(){return e.NSFileType===NSFileTypeDirectory},isFIFO:function(){return!1},isFile:function(){return e.NSFileType===NSFileTypeRegular},isSocket:function(){return e.NSFileType===NSFileTypeSocket},isSymbolicLink:function(){return e.NSFileType===NSFileTypeSymbolicLink}}};var r={EPERM:{message:"operation not permitted",errno:-1},ENOENT:{message:"no such file or directory",errno:-2},EACCES:{message:"permission denied",errno:-13},ENOTDIR:{message:"not a directory",errno:-20},EISDIR:{message:"illegal operation on a directory",errno:-21}};function n(e,t){var n=new Error(e+": "+r[e].message+", "+(t.syscall||"")+(t.path?" '"+t.path+"'":""));return Object.keys(t).forEach((function(e){n[e]=t[e]})),n.code=e,n.errno=r[e].errno,n}e.exports.fsError=n,e.exports.fsErrorForPath=function(t,r,o,i){var a=NSFileManager.defaultManager();if(!a.fileExistsAtPath(t))return n("ENOENT",{path:t,syscall:i||"open"});if(!a.isReadableFileAtPath(t))return n("EACCES",{path:t,syscall:i||"open"});if(void 0!==r){var c=e.exports.lstatSync(t).isDirectory();if(c&&!r)return n("EISDIR",{path:t,syscall:i||"read"});if(!c&&r)return n("ENOTDIR",{path:t,syscall:i||"read"})}return new Error(o||"Unknown error while manipulating "+t)},e.exports.encodingFromOptions=function(e,t){return e&&e.encoding?String(e.encoding):e?String(e):t},e.exports.NOT_IMPLEMENTED=function(e){return function(){throw new Error("fs."+e+" is not implemented yet. If you feel like implementing it, any contribution will be gladly accepted on https://github.com/skpm/fs")}}},function(e,t,r){"use strict";r.r(t),function(e,n){function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"getImagesURLsForItems",(function(){return f}));var c=r(2),s=r(1).toArray,l={headers:{"app-pragma":"no-cache"}};function u(e){return e.reduce((function(e,t){return e.concat(t)}),[])}function f(t,r){var o=r.searchTerm,a=r.photoId,f=t.reduce((function(e,t,r){var n;if(t.type||(t=c.Shape.fromNative(t.sketchObject)),"DataOverride"===t.type){var o=t.override.getFrame&&t.override.getFrame();if(o)n={frame:o};else{var i=s(t.symbolInstance.sketchObject.overrideContainer().flattenedChildren()).find((function(e){return e.availableOverride()==t.override.sketchObject}));if(i){var a=i.pathInInstance(),l=CGPathGetBoundingBox(a);n={frame:{width:Number(l.size.width),height:Number(l.size.height)}}}else n=t.symbolInstance}}else n=t;return n.frame.width>n.frame.height?e.landscape.push({item:t,index:r,frame:n.frame}):n.frame.width<n.frame.height?e.portrait.push({item:t,index:r,frame:n.frame}):n.frame.width===n.frame.height&&e.squarish.push({item:t,index:r,frame:n.frame}),e}),{landscape:[],portrait:[],squarish:[]}),p="https://api.unsplash.com"+(a?"/photos/".concat(a):"/photos/random")+"?client_id=bfd993ac8c14516588069b3fc664b216d0e20fb9b9fa35aa06fcc3ba6e0bc703";return a?e(p,l).then((function(e){return e.json()})).then((function(e){return e.errors?n.reject(e.errors[0]):(e=new Array(t.length).fill(e)).map((function(e,t){return i({data:e},u(Object.values(f))[t])}))})).catch((function(e){return[{error:e}]})):(o&&(p+="&query="+o),n.all(Object.keys(f).map((function(t){var r=f[t];if(!r||!r.length)return n.resolve([]);var o=Math.ceil(r.length/30);return n.all(Array(o).fill().map((function(a,c){var s=c===o-1?r.length%30:30;return e("".concat(p,"&count=").concat(s,"&orientation=").concat(t),l).then((function(e){return e.json()})).then((function(e){return e.errors?n.reject(e.errors[0]):e.map((function(e,t){return i({data:e},r[30*c+t])}))})).catch((function(e){return[{error:e}]}))}))).then(u)}))).then(u))}}.call(this,r(7),r(0))},function(e,t,r){"use strict";r.r(t),function(e,n){r.d(t,"default",(function(){return l})),r.d(t,"getImageFromURL",(function(){return u}));const o=r(4),i=r(3),a=(r(1),r(5)),c=r(2),s=o.join(i.tmpdir(),"com.bomberstudios.sketch-image-downloader");function l(t,r){return e.resolve(u(t).then(e=>{if(e){let t=NSImage.alloc().initWithContentsOfFile(e).representations().objectAtIndex(0),n=t.pixelsWide()/2,o=t.pixelsHigh()/2;return new c.Image({image:e,frame:{width:n,height:o},parent:r})}}))}function u(t){return e.resolve(n(t).then(e=>e.blob()).then(f).catch(e=>{console.error(e)}))}function f(e){const t=NSProcessInfo.processInfo().globallyUniqueString(),r=o.join(s,`${t}.jpg`);try{a.mkdirSync(s)}catch(n){}try{return a.writeFileSync(r,e,"NSData"),r}catch(n){return void console.error(n)}}}.call(this,r(0),r(7))}]);if("default"===e&&"function"==typeof r)r(t);else{if("function"!=typeof r[e])throw new Error('Missing export named "'+e+'". Your command should contain something like `export function " + key +"() {}`.');r[e](t)}}catch(n){if("undefined"==typeof process||!process.listenerCount||!process.listenerCount("uncaughtException"))throw n;process.emit("uncaughtException",n,"uncaughtException")}}globalThis["[object Object]"]=__skpm_run.bind(this,"[object Object]"),globalThis.onRun=__skpm_run.bind(this,"default"),globalThis.onStartup=__skpm_run.bind(this,"onStartup"),globalThis.onShutdown=__skpm_run.bind(this,"onShutdown"),globalThis.onSupplyRandomPhoto=__skpm_run.bind(this,"onSupplyRandomPhoto"),globalThis.onSearchPhoto=__skpm_run.bind(this,"onSearchPhoto");